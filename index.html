<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Santa Express</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #2c3e50;
            font-family: Arial, sans-serif;
        }
        #game-container {
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        h1 {
            text-align: center;
            color: #ecf0f1;
            margin-bottom: 20px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
</head>
<body>
    <div id="content">
        <h1>ðŸŽ„ Santa Express ðŸŽ„</h1>
        <div id="game-container"></div>
    </div>

    <script>
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'game-container',
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 300 },
                    debug: false
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        const game = new Phaser.Game(config);

        function preload() {
            this.load.image('background', 'assets/images/background.png');
            this.load.image('santa-sleigh', 'assets/images/santa-sleigh.png');
            this.load.image('present', 'assets/images/present.png');
            this.load.image('chimney', 'assets/images/chimney.png');
            this.load.image('cloud', 'assets/images/cloud.png');
            this.load.image('bird', 'assets/images/bird.png');
            this.load.image('drone', 'assets/images/drone.png');
            this.load.image('star', 'assets/images/star.png');
            this.load.image('snowflake', 'assets/images/snowflake.png');

            this.load.audio('jingle', 'assets/sounds/jingle.mp3');
            this.load.audio('drop', 'assets/sounds/drop.mp3');
            this.load.audio('collect', 'assets/sounds/collect.mp3');
            this.load.audio('crash', 'assets/sounds/crash.mp3');
            this.load.audio('success', 'assets/sounds/success.mp3');
        }

        function create() {
            // Ajout du fond
            this.add.image(400, 300, 'background');

            // Ajout du traÃ®neau du PÃ¨re NoÃ«l
            this.santa = this.physics.add.sprite(400, 300, 'santa-sleigh');
            this.santa.setCollideWorldBounds(true);

            // Ajout des cheminÃ©es
            this.chimneys = this.physics.add.staticGroup();
            for (let i = 0; i < 5; i++) {
                this.chimneys.create(Phaser.Math.Between(100, 700), 550, 'chimney');
            }

            // Ajout des obstacles
            this.obstacles = this.physics.add.group();
            this.time.addEvent({
                delay: 2000,
                callback: addObstacle,
                callbackScope: this,
                loop: true
            });

            // Ajout des Ã©toiles
            this.stars = this.physics.add.group();
            this.time.addEvent({
                delay: 5000,
                callback: addStar,
                callbackScope: this,
                loop: true
            });

            // ContrÃ´les
            this.cursors = this.input.keyboard.createCursorKeys();

            // Collision entre le PÃ¨re NoÃ«l et les obstacles
            this.physics.add.collider(this.santa, this.obstacles, hitObstacle, null, this);

            // Collision entre le PÃ¨re NoÃ«l et les Ã©toiles
            this.physics.add.overlap(this.santa, this.stars, collectStar, null, this);

            // Musique de fond
            this.sound.play('jingle', { loop: true });

            // Score et temps
            this.score = 0;
            this.timeLeft = 60;
            this.scoreText = this.add.text(16, 16, 'Score: 0', { fontSize: '32px', fill: '#fff' });
            this.timeText = this.add.text(16, 56, 'Time: 60', { fontSize: '32px', fill: '#fff' });
        }

        function update() {
            // ContrÃ´les du traÃ®neau
            if (this.cursors.left.isDown) {
                this.santa.setVelocityX(-160);
            } else if (this.cursors.right.isDown) {
                this.santa.setVelocityX(160);
            } else {
                this.santa.setVelocityX(0);
            }

            if (this.cursors.up.isDown) {
                this.santa.setVelocityY(-160);
            } else if (this.cursors.down.isDown) {
                this.santa.setVelocityY(160);
            } else {
                this.santa.setVelocityY(0);
            }

            // Lancer un cadeau
            if (Phaser.Input.Keyboard.JustDown(this.cursors.space)) {
                dropPresent.call(this);
            }

            // Mise Ã  jour du temps
            this.timeLeft -= this.time.physicsElapsed;
            this.timeText.setText('Time: ' + Math.ceil(this.timeLeft));

            if (this.timeLeft <= 0) {
                this.scene.restart();
            }
        }

        function addObstacle() {
            const obstacleTypes = ['cloud', 'bird', 'drone'];
            const randomType = Phaser.Math.RND.pick(obstacleTypes);
            const x = 800;
            const y = Phaser.Math.Between(100, 500);
            const obstacle = this.obstacles.create(x, y, randomType);
            obstacle.setVelocityX(Phaser.Math.Between(-200, -100));
        }

        function addStar() {
            const x = 800;
            const y = Phaser.Math.Between(100, 500);
            const star = this.stars.create(x, y, 'star');
            star.setVelocityX(-100);
        }

        function hitObstacle(santa, obstacle) {
            this.sound.play('crash');
            obstacle.disableBody(true, true);
            this.timeLeft -= 5;
        }

        function collectStar(santa, star) {
            this.sound.play('collect');
            star.disableBody(true, true);
            this.score += 10;
            this.scoreText.setText('Score: ' + this.score);
        }

        function dropPresent() {
            const present = this.physics.add.sprite(this.santa.x, this.santa.y, 'present');
            present.setVelocityY(200);
            this.sound.play('drop');

            this.physics.add.collider(present, this.chimneys, function(present, chimney) {
                present.disableBody(true, true);
                this.sound.play('success');
                this.score += 20;
                this.scoreText.setText('Score: ' + this.score);
            }, null, this);
        }
    </script>
</body>
</html>
