<!DOCTYPE html>
<html>
<head>
    <title>Santa Express</title>
    <meta charset="UTF-8">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(to bottom, #1a0f1f 0%, #2a1f3f 100%);
            color: white;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

        #gameContainer {
            position: relative;
            margin: 20px auto;
            width: 800px;
            height: 600px;
        }

        canvas {
            border: 5px solid #c41e3a;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.3);
            display: none;
        }

        .menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(20, 0, 10, 0.95);
            padding: 2rem;
            border-radius: 15px;
            min-width: 400px;
            border: 3px solid #c41e3a;
            display: none;
            box-shadow: 0 0 20px rgba(196, 30, 58, 0.3);
        }

        .menu.active {
            display: block;
        }

        .btn {
            background: #c41e3a;
            border: 2px solid #ff9900;
            padding: 12px 30px;
            margin: 10px;
            border-radius: 25px;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .btn:hover {
            transform: scale(1.05);
            background: #ff0033;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
        }

        h1, h2 {
            color: #ff9900;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        h1 { font-size: 3em; }
        h2 { font-size: 2em; }

        .setting-item {
            margin: 20px 0;
            text-align: left;
        }

        .setting-item label {
            display: block;
            color: #ff9900;
            margin-bottom: 8px;
        }

        .setting-item input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }

        .key-binding {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }

        .key-binding button {
            background: #2a1f3f;
            border: 1px solid #c41e3a;
            padding: 5px 15px;
            color: white;
            border-radius: 3px;
            cursor: pointer;
        }

        #hud {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            background: rgba(20, 0, 10, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #c41e3a;
            display: none;
        }

        .snowflake {
            position: fixed;
            pointer-events: none;
            animation: fall linear forwards;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div id="mainMenu" class="menu active">
            <h1>üéÑ Santa Express üéÑ</h1>
            <button class="btn" onclick="startGame()">Jouer</button>
            <button class="btn" onclick="showSettings()">Param√®tres</button>
            <button class="btn" onclick="showControls()">Contr√¥les</button>
        </div>

        <div id="settings" class="menu">
            <h2>‚öôÔ∏è Param√®tres</h2>
            <div class="setting-item">
                <label>Musique:</label>
                <input type="range" id="musicVolume" min="0" max="100" value="50">
            </div>
            <div class="setting-item">
                <label>Effets sonores:</label>
                <input type="range" id="sfxVolume" min="0" max="100" value="70">
            </div>
            <button class="btn" onclick="backToMain()">Retour</button>
        </div>

        <div id="controls" class="menu">
            <h2>üéÆ Contr√¥les</h2>
            <div class="key-binding">
                <span>Haut:</span>
                <button onclick="changeKey('up')" id="upKey">‚Üë</button>
            </div>
            <div class="key-binding">
                <span>Bas:</span>
                <button onclick="changeKey('down')" id="downKey">‚Üì</button>
            </div>
            <div class="key-binding">
                <span>Gauche:</span>
                <button onclick="changeKey('left')" id="leftKey">‚Üê</button>
            </div>
            <div class="key-binding">
                <span>Droite:</span>
                <button onclick="changeKey('right')" id="rightKey">‚Üí</button>
            </div>
            <div class="key-binding">
                <span>Lancer cadeau:</span>
                <button onclick="changeKey('drop')" id="dropKey">Espace</button>
            </div>
            <button class="btn" onclick="backToMain()">Retour</button>
        </div>

        <div id="hud">
            <div id="score">üéÅ Score: 0</div>
            <div id="timer">‚è∞ Temps: 60s</div>
        </div>
    </div>

    <script>
        // Configuration
        const config = {
            controls: {
                up: 'ArrowUp',
                down: 'ArrowDown',
                left: 'ArrowLeft',
                right: 'ArrowRight',
                drop: ' '
            },
            audio: {
                music: new Audio('assets/sounds/jingle.mp3'),
                effects: {
                    drop: new Audio('assets/sounds/drop.mp3'),
                    collect: new Audio('assets/sounds/collect.mp3'),
                    crash: new Audio('assets/sounds/crash.mp3'),
                    success: new Audio('assets/sounds/success.mp3')
                }
            },
            volumes: {
                music: 0.5,
                sfx: 0.7
            }
        };

        // Chargement des images
        const images = {
            santa: new Image(),
            present: new Image(),
            chimney: new Image(),
            cloud: new Image(),
            bird: new Image(),
            drone: new Image(),
            star: new Image(),
            background: new Image(),
            snowflake: new Image()
        };

        Object.keys(images).forEach(key => {
            images[key].src = `assets/images/${key}.png`;
        });

        // Configuration audio
        config.audio.music.loop = true;

        const musicVolumeSlider = document.getElementById('musicVolume');
        const sfxVolumeSlider = document.getElementById('sfxVolume');

        musicVolumeSlider.addEventListener('input', (e) => {
            config.volumes.music = e.target.value / 100;
            config.audio.music.volume = config.volumes.music;
        });

        sfxVolumeSlider.addEventListener('input', (e) => {
            config.volumes.sfx = e.target.value / 100;
            Object.values(config.audio.effects).forEach(sound => {
                sound.volume = config.volumes.sfx;
            });
        });

        // Menu functions
        function showSettings() {
            hideAllMenus();
            document.getElementById('settings').classList.add('active');
        }

        function showControls() {
            hideAllMenus();
            document.getElementById('controls').classList.add('active');
        }

        function backToMain() {
            hideAllMenus();
            document.getElementById('mainMenu').classList.add('active');
        }

        function hideAllMenus() {
            document.querySelectorAll('.menu').forEach(menu => {
                menu.classList.remove('active');
            });
        }

        // Key binding system
        let changingKey = '';

        function changeKey(action) {
            changingKey = action;
            document.getElementById(`${action}Key`).textContent = 'Appuyez sur une touche...';
        }

        window.addEventListener('keydown', (e) => {
            if (changingKey) {
                config.controls[changingKey] = e.key;
                document.getElementById(`${changingKey}Key`).textContent = e.key;
                changingKey = '';
                e.preventDefault();
            }
        });

        // Game state
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let gameRunning = false;
        let score = 0;
        let timeLeft = 60;
        let lastTime = 0;

        // Game objects
        const player = {
            x: 100,
            y: canvas.height / 2,
            width: 80,
            height: 40,
            speed: 5
        };

        let presents = [];
        let chimneys = [];
        let obstacles = [];
        let stars = [];
        let clouds = [];
        let snowflakes = [];

        // Controls state
        const keys = {};
        window.addEventListener('keydown', e => keys[e.key] = true);
        window.addEventListener('keyup', e => keys[e.key] = false);

        function playSound(name) {
            const sound = config.audio.effects[name];
            if (sound) {
                sound.currentTime = 0;
                sound.volume = config.volumes.sfx;
                sound.play().catch(() => {});
            }
        }

        function startGame() {
            gameRunning = true;
            score = 0;
            timeLeft = 60;
            
            hideAllMenus();
            canvas.style.display = 'block';
            document.getElementById('hud').style.display = 'block';

            // Reset game objects
            presents = [];
            chimneys = [];
            obstacles = [];
            stars = [];
            clouds = [];
            snowflakes = [];

            // Start music
            config.audio.music.volume = config.volumes.music;
            config.audio.music.play().catch(() => {});

            // Start game loop
            requestAnimationFrame(gameLoop);
        }

        function addChimney() {
            chimneys.push({
                x: canvas.width,
                y: canvas.height - 100,
                width: 60,
                height: 100
            });
        }

        function addObstacle() {
            const type = Math.random() < 0.5 ? 'bird' : 'drone';
            obstacles.push({
                x: canvas.width,
                y: Math.random() * (canvas.height - 40),
                width: 40,
                height: 40,
                type: type,
                speed: type === 'bird' ? 3 : 4
            });
        }

        function addStar() {
            stars.push({
                x: canvas.width,
                y: Math.random() * (canvas.height - 30),
                width: 30,
                height: 30
            });
        }

        function addCloud() {
            clouds.push({
                x: canvas.width,
                y: Math.random() * (canvas.height / 2),
                width: 100,
                height: 60,
                speed: 1 + Math.random()
            });
        }

        function addSnowflake() {
            snowflakes.push({
                x: Math.random() * canvas.width,
                y: -10,
                size: 5 + Math.random() * 5,
                speed: 1 + Math.random() * 2
            });
        }

        function updateGame() {
            // Update player
            if (keys[config.controls.up]) player.y = Math.max(0, player.y - player.speed);
            if (keys[config.controls.down]) player.y = Math.min(canvas.height - player.height, player.y + player.speed);
            if (keys[config.controls.left]) player.x = Math.max(0, player.x - player.speed);
            if (keys[config.controls.right]) player.x = Math.min(canvas.width - player.width, player.x + player.speed);
            if (keys[config.controls.drop]) {
                const newPresent = {
                    x: player.x + player.width/2,
                    y: player.y + player.height,
                    width: 30,
                    height: 30,
                    speed: 5
                };
                presents.push(newPresent);
                playSound('drop');
                keys[config.controls.drop] = false; // Prevent holding
            }

            // Update game objects
            updatePresents();
            updateChimneys();
            updateObstacles();
            updateStars();
            updateClouds();
            updateSnowflakes();

            // Spawn new objects
            if (Math.random() < 0.02) addChimney();
            if (Math.random() < 0.01) addObstacle();
            if (Math.random() < 0.03) addStar();
            if (Math.random() < 0.01) addCloud();
            if (Math.random() < 0.1) addSnowflake();
        }

        function updatePresents() {
            presents = presents.filter(present => {
                present.y += present.speed;
                
                // Check chimney collisions
                for (let chimney of chimneys) {
                    if (checkCollision(present, chimney)) {
                        score += 100;
                        document.getElementById('score').textContent = `üéÅ Score: ${score}`;
                        playSound('success');
                        return false;
                    }
                }
                
                return present.y < canvas.height;
            });
        }

        function updateChimneys() {
            chimneys = chimneys.filter(chimney => {
                chimney.x -= 2;
                return chimney.x + chimney.width > 0;
            });
        }

        function updateObstacles() {
            obstacles = obstacles.filter(obstacle => {
                obstacle.x -= obstacle.speed;
                if (obstacle.type === 'bird') {
                    obstacle.y += Math.sin(obstacle.x / 30) * 2;
                }
